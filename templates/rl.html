{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Train Factory RL Model</h1>
    
    <form id="train-form" class="space-y-4 bg-gray-800 p-4 rounded-lg">
        <div>
            <label class="block">Max Material Rate:</label>
            <input type="number" id="max_material_rate" value="20" min="1"
                   class="w-full p-2 rounded bg-gray-700 text-white"/>
        </div>
        <div>
            <label class="block">Target Throughput:</label>
            <input type="number" id="target_throughput" value="50" min="1"
                   class="w-full p-2 rounded bg-gray-700 text-white"/>
        </div>
        <div>
            <label class="block">Total Timesteps:</label>
            <input type="number" id="total_timesteps" value="50000" min="1"
                   class="w-full p-2 rounded bg-gray-700 text-white"/>
        </div>
        <button type="submit" class="px-4 py-2 bg-teal-500 rounded hover:bg-teal-400 transition-colors">Train Model</button>
    </form>

    <div class="mt-6">
        <h2 class="text-xl font-semibold mb-2">Training Output / Optimal Configuration:</h2>
        <pre id="output" class="bg-gray-800 p-4 rounded h-64 overflow-auto">Waiting for training to start...</pre>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const form = document.getElementById("train-form");
const output = document.getElementById("output");

form.addEventListener("submit", async (e) => {
    e.preventDefault();
    output.textContent = "Training started...\n";

    // Send POST request to train model
    const response = await fetch("/train-rl-model", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            max_material_rate: parseInt(document.getElementById("max_material_rate").value),
            target_throughput: parseInt(document.getElementById("target_throughput").value),
            total_timesteps: parseInt(document.getElementById("total_timesteps").value)
        })
    });

    // Get JSON result
    const data = await response.json();

    // Display optimal configuration and final state
    output.textContent = "Training completed!\n\n" + JSON.stringify(data, null, 2);
});
</script>
{% endblock %}

